---
layout: post
title: 计算机网络知识笔记
<!-- date: 2020-05-30 12:25:06 -0700 -->
<!-- tags: computer network -->
<!-- comments: true -->
categories: computer network
---


* TOC
{:toc}

因特网概述
==============

1\. 网络、互连网（互联网）、因特网的基本概念

网络（Network）
: 由若干节点（Node）和连接这些节点的链路（Link）组成。

互连网（互连网）
: 多个网络由路由器互连起来，形成的覆盖范围更大的网络。互联网是“网络的网络”（Network of Networks）。

因特网（Internet）
: 是世界上最大的互连网络。

internet vs Internet
: - internet是通用名词，泛指由多个计算机互连而成的网络。这些网络之间的通信协议可以是任意的。
: - Internet是专有名词，指全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，采用TCP/IP协议簇作为通信规则。

2\. 因特网服务提供者ISP(Internet Service Provider)

普通用户通过ISP接入因特网。

ISP从因特网管理机构申请成块的IP地址，同时具有通信线路及路由器等设备。任何机构和个人向ISP交纳费用可以得到所需IP地址。因特网上的主机必须有IP地址才能通信。

我国主要的ISP是中国电信、中国联通和中国移动三大电信运营商。

3\. 基于ISP三层结构的因特网

- 第一层ISP为最高级，服务面积最大，被称为因特网主干网，覆盖国际性区域范围，有高速链路和交换设备。第一层ISP之间直接互连。
- 第二层ISP和一些大公司都是第一层ISP的用户。通常具有区域性和国家性覆盖规模。与少数第一层连接。
- 第三层称为本地ISP，是第二层ISP用户，只拥有本地范围网络，一般校园网，企业网，住宅用户，无限移动用户为该层ISP用户。

相隔较远的两个主机间的通信可能需要经过多个ISP。

一旦某个用户能接入因特网，那么也可以成为一个ISP，需要做的只是购买一些调制解调器、路由器等设备，使其他用户可以和其相连。

4\. 因特网的组成

从功能上看，划分为两部分：**边缘部分**和**核心部分**。

**边缘部分**由所有连接在因特网上的主机组成，用户直接使用，用来进行通信和资源共享。主机可以是台式电脑、大型服务器，笔记本电脑、平板电脑、智能手机、智能手表、物联网智能硬件，如空气质量检测仪、智能摄像头等。

**核心部分**由大量网络和连接这些网络的路由器组成，为边缘部分服务，提供联通性和交换。核心部分起特殊作用的是路由器，它是一种专用计算机，是实现分组交换的关键部件，任务是转发收到的分组，这是网络核心部分最重要的功能。

三种交换方式
==============

电路交换（Circut Switching）
: 电信网络（电话线路）。

报文交换（Message Switching）
: 主要用于早期的电报通信网，现在较少使用，被分组交换取代。

分组交换（Packet Switching）
: 最重要的分组交换机是路由器，负责将各种网络连接起来，并对接收到的分组进行转发，即分组交换。

分组交换过程中，发送方完成的任务为构造分组和发送分组；路由器（分组交换机）完成的任务为缓存分组和转发分组，简称存储转发；接收方完成的任务为接收分组和还原报文。

**三种交换方式对比**：

**电路交换**

优点：

1）通信时延小，因为通信线路为通信双方专用，数据直达；
2）有序传输，不存在失序问题；
3）没有冲突，不同的通信双方有不同的信道，不存在征用问题；
4）实用范围广：模拟信号，数字信号；
5）实时性强；
6）控制简单；

缺点：

1）建立时间长；
2）线路独占，使用效率低；
3）灵活性差：故障需重新拨号；
4）难以规格化，难以差错控制；

**报文交换**

优点：

1）无需建立连接：通道不专用；
2）动态分配线路；
3）提高线路可靠性：某一路径故障选择另一条路径；
4）提高线路利用率；
5）提供多目标服务：一个报文发送给多个目的地址；

缺点：

1）引起转发时延：存储转发过程；
2）需要较大的存储缓存空间；
3）需要传输额外信息：需要携带目标地址，源地址等信息；

**分组交换**

优点：

1）无需建立连接；
2）线路利用率高；
3）简化了存储管理：相对报文交换，分组长度固定，缓冲区大小固定，管理容易；
4）加速传输：分组为逐个传输，使得后一个分组的存储操作和前一个分组的转发操作可以同时进行；
5）减少出错概率和重发数据量：出错只需重传出错部分；

缺点：

1）引起转发时延；
2）需要传输额外信息：将原始报文分隔成等长数据块，每个数据块需加入源地址和目的地址；
3）可能出现失序、丢失或重复分组，到目的地址后需要重新还原；

计算机网络的定义和分类
==============

1\. 计算机网络的定义

并不统一；

最简单定义
: 一些互相连接的、自治的计算机的集合；

互连
: 有限或无线方式进行数据通信；

自治
: 独立的计算机，有自己的硬件和软件，可以单独运行使用；

集合
:至少需要两台计算机；

现阶段较好的定义
： 由一些通用、可编程的硬件互连而成，这些硬件并非专门用来实现某一特定目的（如传送数据信号、视频信号），而是可以传送多种不同类型的数据，并支持广泛的日益增长的应用。

注：所连接的硬件，不限于计算机，而是包含智能手机等智能硬件；计算机网络并非专门用来传送数据，而是可以支持很多种应用。

2\. 计算机网络的分类

（1）按交换技术：链路交换网络、报文交换网络、分组交换网络；

（2）按网络的使用者：公用网（也可称为公众网，电信公司出资建造的大型网络，按规定交纳费用的人都可以使用）、专用网（如军队、铁路、电力等系统）；

（3）按传输介质：有线（包括双绞线、光纤等）、无线（wifi）；

（4）按覆盖范围：广域网（WAN），城域网（MAN），局域网（LAN），个域网（PAN）（家用路由器一般一个WAN接口和多个LAN接口）；

广域网
: 因特网的核心部分，为核心路由器提供远距离（如跨越不同国家）；

城域网
: 一般范围为一个城市，可跨越几个街区到整个城市，一般作为城市主干网，互连大量企业、机构和校园局域网，近几年，已开始成为现代城市的信息服务基础设施，为大量用户提供接入和各种信息服务，并有趋势将传统的电信、有限电视和互联网服务融为一体；

局域网
: 一般用微型计算机或工作站通过高速通信线路相连，地理上局限在较小范围呢，如几个实验室、一栋楼、或一个校园内，距离一般为几公里，一般有某个单位单独使用和维护；现在局域网使用广泛；一个学校或企业大多拥有许多互连的局域网，通常称为校园网或企业网；

个域网
: 个人区域网络，不是用来连接计算机的，而是在个人工作的地方把个人使用的电子设备如便携式计算机、打印机、鼠标、键盘、耳机等，用无线技术连接起来的网络，也成为了无线个人区域网WPAN，覆盖范围约为10米；若中央处理器之间的距离非常近，如1米以下，一般称为多处理机系统；

（5）按拓扑结构：总线型、星型、环型、网状型；还可以基于四种基本结构互联为更复杂的网络；

计算机网络性能指标
==============

1\. 速率：

比特
: 计算机中数据量的单位，也是信息论中信息量的单位；一个比特是0或1；

8 bit = 1 Byte（或B）（1字节=8比特），另有KB, MB, GB, TB

速率
: 主机在数字信道上传送比特的速率，也称为比特率或数据率；单位bit/s (b/s,bps)

2\. 带宽：

模拟信号中的定义
: 信号所包含的不同频率成分所占据的频率范围；单位：Hz

计算机网络中的定义
: 网络的通信线路所能传送数据的能力，表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”，单位b/s；

吞吐量
: 在单位时间内通过某个网络（或信道、接口）的数据量；受网络的带宽或额定速率的限制；

3\. 时延：

分组从源主机传送给目的主机的过程中：

源主机将分组发往传输线路，需要的时间，称为**发送时延**；

代表分组的电信号在链路上传输，称为**传播时延**；

路由器收到分组，进行存储转发，称为**处理时延**；

一般源主机和目的主机之间有多段链路和多个路由器，因此会有多个传播时延和处理时延；

4\. 时延带宽积：

**时延带宽积** = 传播时延 * 带宽

因特网上信息是双向交互的；**往返时间RTT(Round-Trip-Time)**；

5\. 利用率：

信道利用率
: 某信道有百分之几的时间是被利用的（有数据通过）；

网络利用率
: 全网络的信道利用率的加权平均；

信道利用率并非越高越好，利用率过高时延会增加；

6\. 丢包率：

分组的丢失率
: 指在一定时间范围内，传输过程中丢失的分组数量与总分组数量的比率；

分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率；

计算机网络体系结构
==============

1\.常见的网络体系结构

OSI七层体系结构（法律上的国际标准）
: 物理层、数据链路层、网络层、运输层、会话层、表示层、应用层；

因特网使用的TCP\/IP体系结构（事实上的国际标准）
: 网络接口层、网际层（核心协议：IP）、运输层（两个重要协议：TCP、UDP）、应用层（包含如：HTTP、SMTP、DNS、RTP等）；

原理体系结构
: 物理层、数据链路层、网络层、运输层、应用层；

物理层
: 解决使用何种信号表示比特的问题；

数据链路层
: 解决分组在一个网络（或一个链路）上传输的问题；

网络层
: 解决分组在多个网络上传输和路由的问题；

运输层
: 解决进程之间基于网络的通信问题；

应用层
: 通过应用进程的交互实现特定网络应用的问题；

2\. 专用术语

实体
: 任何可发送或接受信息的硬件或软件进程；

协议
: 控制两个对等实体进行逻辑通信的规则的集合；

协议的三要素
: 语法、语义、同步（定义收发双方的时序关系）；

服务
: 在协议控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务。

物理层
==============

1\. 物理层的基本概念：考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流；

物理层为数据链路层屏蔽了各种传输媒体的差异，是数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体是什么。

2\. 物理层下面的传输媒体：

分为导引型、非导引型；

导引型
: 同轴电缆、双绞线、光纤、电力线；

非导引型
: 无线电波、微波、无线电、可见光；

3\. 传输方式：

串行和并行；同步和异步；单工（单向通信）、半双工（双向交替通信）、（全双工）双向同时通信；

4\.编码与调制：

码元
: 在使用时间域的波形表示数字信号时，代表不同离散数值的基本波形；

5\.信道的极限容量

奈氏准则
: 在假定的理想条件下，为了避免码间串扰，码元传输速率是有上限的；

香农公式
: 贷款受限且有高斯宝噪声干扰的信道的极限信息传输速率；

在信道带宽一定的情况下，根据奈氏准则和香农公式，要想提高信息的传输速率必须采取多元制（更好的调制方法）和努力提高信道中的信噪比；

自从香农公式发表后，各种新的信号处理和调制方法就不断出现，其目的都是为了尽可能地接近香农公式给出的传输速率极限；

数据链路层
==============

1\. 概述

链路（Link）
: 从一个结点到相邻结点的一段物理线路，中间没有其他交换结点；

数据链路（Data Link）
: 把实现通信协议的硬件和软件加到链路上，就构成了数据链路；

数据链路层以帧为单位传输和处理数据；

点对点信道的数据链路层的三个重要问题: 封装成帧、差错检测、可靠传输。

2\. 封装成帧

概念指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧；

透明传输是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样；

- 面向字节的物理链路使用字节填充（或称字符填充）的方法实现透明传输；

- 面向比特的物理链路使用比特填充的方法实现透明传输；

3\. 差错检测

在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率BER（Bit Error Rate）；

使用差错检测码来检测数据在传输过程中是否产生了比特查错，这是数据链路层要解决的重要问题之一；

奇偶校验；循环冗余校验；

4\. 可靠传输

（1）可靠传输的基本概念 

比特差错只是传输差错中的一种，传输差错还包括：分组丢失、分组失序、分组重复；

分组丢失、分组失序以及分组重复一般不会出现在数据链路层，而是出现在其上层；

可靠传输服务不限于数据链路层，其他四层均可选择实现可靠传输：

-网络接口层
: 802.11无线局域网要求数据链路层实现可靠传输；以太网不要求数据链路层实现可靠传输；

-网际层
: IP向其上层提供无连接、不可靠传输服务；

-运输层
: UDP向其上层提供无连接、不可靠传输服务；TCP向其上层提供面向连接的可靠传输服务；

（2）可靠传输的实现机制

停止等待协议，回退N帧协议GBN，选择重传协议SR；

5\. 点对点协议PPP

PPP是目前使用最广泛的点对点数据链路层协议；

用户计算机与ISP进行通信时所使用的数据链路层协议通常就是PPP协议；

6\. 媒体接入控制

（1）基本概念

共享信道要着重考虑的问题是如何协调多个发送和接收站点对一个共享传输媒体的占用，即媒体接入控制MAC（Medium Access Control）；

媒体接入控制分为：静态划分信道（频分多址，时分多址，码分多址），动态接入控制（随机接入）；

随着技术的发展，交换技术的成熟和成本的降低，具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代共享式局域网，但由于无线信道的广播天性，无线局域网仍然使用共享媒体技术；

（2）静态划分信道

复用（Multiplexing）
: 通过一条物理线路同时传输多路用户的信号。

复用技术: 频分复用FDM，时分复用TDM，波分复用WDM，码分复用CDM。

（3）随机接入

CSMA/CD协议的工作原理：多址接入MA，载波监听CS，碰撞检测CD。

7\. MAC地址、IP地址、ARP协议

MAC（Media Access Control）地址
: 以太网的MAC子层使用；（属于数据链路层）

每个网络适配器都有全球唯一的MAC地址，而交换机和路由器往往拥有更多的网络接口，因此会有更多的MAC地址。严格来说，MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。

为了保护个人隐私，目前大多数移动设备已采用随机MAC地址技术。

IP地址
: TCP/IP体系结构网际层使用；（属于网际层）

是因特网上的主机和路由器所使用的地址，用于标识两部分信息：网络编号（标识因特网上数以百万计的网络），主机编号（标识同一网络上不同主机（或路由器各接口））

注：如果只是一个单独网络，不接入因特网，可以只是用MAC地址；如果要接入因特网，则IP地址和MAC地址都需要使用；

ARP协议
: 属于TCP/IP体系结构的网际层，作用是已知设备分配到的IP地址，使用ARP协议可以通过该IP地址获取到设备的MAC地址；（属于网际层）

8\. 集线器和交换机的区别

9\. 以太网交换机自学习和转发帧的流程

10\. 以太网交换机生成树协议STP

11\. 虚拟局域网VLAN（Virtual Local Area Network）：

是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同需求。

实现机制：交换机上实现，需要交换机能够实现两大功能：

1）能够处理带有VLAN标记的帧（IEEE 802.1Q帧也称Dot One Q帧）

2）交换机的各端口可以支持不同的端口类型；

网络层
==============

1\. 概述

网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输。

网络层解决的主要问题：

- 向运输层提供怎样的服务（“可靠传输” 还是“不可靠传输”）
- 寻址问题
- 路由选择问题

2\. 网络层提供的两种服务

(1) 面向连接的虚电路服务 

虚电路的核心思想： 可靠通信由网络来保证。

当两台计算机通信时，首先建立网络层的连接，也就是建立**虚电路VC (Virtual Circuit)**，保证通信双方所需的一切网络资源。 

通信双方沿着已建立的虚电路发送分组。

目的主机地址仅在连接建立阶段使用，之后每个分组的首部只需携带一条虚电路的编号（构成虚电路的每一段链路都有一个虚电路编号）。

这种通信方式如果使用可靠传输的网络协议，可以使所发送的分组最终正确到达接收方（无差错按序到达、不丢失、不重复）。

通信结束后释放。

很多广域分组交换网使用。

(2) 无连接的数据报服务(因特网使用)

可靠通信应当由用户主机保证。

不需要建立网络层连接。

每个分组可走不同路径。

每个分组的首部必须携带目的主机的完整地址。

可能出现误码、丢失、重复和失序问题。

网络本身不提供端到端的可靠传输服务，使得路由器与电信网的交换机相比价格低廉。

因特网采用这种设计思想，将复杂的网络处理功能置于因特网边缘（用户主机和其内部运输层），将相对简单的尽最大努力的分组交付功能置于因特网核心。

3\. IPV4地址

IPv4地址是给因特网（Internet）上的每一台主机（或路由器）的每一个接口分配一个在全世界范围内是唯一的32比特的标识符。

IPv4地址编址方法的三个历史阶段：分类编址、划分子网、无分类编址。

（1） 分类编址的IPv4地址

32比特的IPv4地址一般采用点分十进制表示方法以便于使用。

IPv4分为四类A-E。A类最高位为0，B类最高位为10，C类110，D类1110，E类1111。

注：
- 只有A类、B类和C类地址可分配给网络中的主机或路由器的各接口。
- 主机号为“全0”的地址是网络地址，不能分配给主机或路由器各接口。
- 主机号为“全1”的地址是广播地址，不能分配给主机或路由器各接口。

A类地址：
- 最小网络号0，保留不指派；
- 第一个可指派的网络号为1，网络地址为1.0.0.0；
- 最大网络号127，作为本地环回测试地址，不指派；
- 最小本地环回测试地址为127.0.0.1；
- 最大本地环回测试地址为127.255.255.254；

B类地址：
- 最小网络号128.0，网络地址为128.0.0.0；
- 最大网络号191.255，网络地址为191.255.0.0；

C类地址：
- 最小网络号192.0.0，网络地址为192.0.0.0；
- 最大网络号223.255.255，网络地址为223.255.255.0；

（2） 划分子网的IPv4地址

子网掩码
: 32比特的子网掩码可以表明分类IP地址的主机号部分被借用了几个比特币作为子网号；连续的比特1对应网络号和子网号，连续的比特0对应主机号；将划分子网的IPv4地址与其相应的子网掩码进行逻辑与运算可以得到子网的网络地址。

未划分子网的情况下的默认子网掩码：A类-255.0.0.0；B类-255.255.0.0；C类-255.255.255.0；

（3） 无分类编码的IPv4地址

IPv4地址耗尽问题。

无分类域间路由选择CIDR
: 使用“斜线记法”，即在IPv4地址后面加上斜线“/”，在斜线后面写上网络前缀所占的比特数量。

（4）IPv4地址的应用规划

定长的子网掩码FLSM，变长的子网掩码VLSM；

4\. IP数据报的发送和转发

默认网关
: 用户为了让本网络中的主机和其他网络中的主机进行通信，必须指定本网路中的路由器，帮忙进行转发，所指定的路由器称为默认网关。

5\. 静态路由配置

静态路由配置
: 用户或管理员使用路由器的相关命令给路由器人工配置路由表。

静态路由配置的特点:
- 配置简单，但不能及时适应网络状态（流量、拓扑等）的变化。
- 一般只在小规模网络中采用。

使用静态路由配置可能导致的环路错误：（1）配置错误（2）聚合了不存在的网络（3）网络故障

6\. 路由选择协议

分类：静态路由选择，动态路由选择。

**静态路由选择**

（1）包括由人工配置的网络路由、默认路由、特定主机路由、黑洞路由等。

（2）方式简单、开销小。但不能及时适应网络状态的变化。

（3）一般只在小规模网络中采用。

**动态路由选择**

（1）路由器通过路由选择协议自动获取路由信息。

（2）比较复杂、开销大，能较好适应网络变化。

（3）适用于大规模网路。

因特网才用的路由选择协议的特点：（1）自适应（2）分布式（3）分层次

**常见的路由选择协议**

（1）内部网关协议IGP（或称内部路由协议IRP）：包括路由信息协议RIP（最早），开放式最短路径优先OSPF等；

（2）外部网关协议EGP（或称外部路由协议ERP）：边界网关协议BGP；

7\. IPv4数据报的首部格式

由20字节的固定部分和40字节的可变部分（可选字段）组成；

8\. 网际控制报文协议ICMP

为了有效地转发IP数据报和提高交付成功的机会，在网际层使用了网际控制报文协议ICMP(Internet Control Message Protocol)；

主机或路由器使用ICMP来发送差错报告报文和询问报文；

ICMP报文被封装在IP数据报中发送；

9\. 虚拟专用网VPN和网络地址转换NAT

虚拟专用网VPN(Virtual Private Network)
: 利用公用的因特网作为本机构各专用网之间的通信载体；

由于IPv4地址的紧缺，虚拟专用网中的各主机所分配的地址是本机构可自由分配的专用地址，而不是需要申请的、在因特网上使用的公有地址。

网络地址转换NAT(Network Address Translation):进一步缓解IPv4地址的耗尽速度；NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问访问因特网上的主机和资源。

运输层
==============

1\. 概述

计算机网络体系中的物理层、数据链路层和网络层共同解决了将主机通过异构网络互连起来所面临的问题，实现了主机到主机的通信；但实际上进行通信的真正实体是位于通信两端主机中的进程。

运输层的任务：为运行在不同主机上的应用进程提供直接的通信服务；运输层协议又称为端到端协议；

根据应用需求不同，运输层为应用层提供了两种运输协议：面向连接的TCP和无连接的UDP；

运输层使用端口号区分不同的应用进程；

2\. 运输层端口号、复用和分用

运行在计算机上的进程使用进程标识符PID来标志；不同的操作系统使用不同格式的进程标识符，为了使不同系统中的进程通信，必须使用统一的方法对TCP/IP体系的应用进程进行标识；

**端口号**
TCP/IP体系的运输层使用端口号来区分应用层不同的应用进程；

端口号用16比特表示，取值范围0-65535：
- 熟知端口号：0-1023，最重要的一些应用协议使用，如FTP使用21/20，HTTP使用80，DNS使用53；
- 登记端口号：1024-49151，为没有熟知端口号的应用程序使用，必须在IANA登记，防止重复;
- 短暂端口号：49152-65535，留给客户进程选择暂时使用。

端口号只具有本地意义，不同计算机中的相同端口号是没有联系的。

发送方的复用和接收方的分用：发送方的某些应用进程所发送的报文在运输层使用UDP协议进行封装，称为UDP复用；另一些使用TCP协议进行封装，称为TCP复用；在网络层两种都需要使用IP协议封装，称为IP复用；在接收方中，过程与发送方的复用过程相反，称为IP、UDP和TCP的分用

TCP/IP体系的应用层常用协议所使用的运输层熟知端口号：（1）UDP：RIP(520), DNS(53), TFTP(69), SNMP(161), DHCP(67/68) （2）TCP：SMTP(25), FTP(21/20), BGP(179), HTTP(80), HTTPS(443)

3\. UDP和TCP协议的对比

**用户数据报协议UDP(User Datagram Protocol)**：

（1）通信双方可以随时发送数据；

（2）无连接；

（3）支持单播、多播及广播；

（4）面向应用报文；

（5）向上层提供无连接不可靠传输（应用e.g.：IP电话、视频会议等实时应用）；

**传输控制协议TCP(Transmission COntrol Protocol)**：

（1）在数据传输之前必须使用“三报文握手”建立连接，结束后必须使用“四报文挥手”释放连接；

（2）面向连接的TCP；

（3）仅支持单播（一对一通信）；

（4）面向字节流的；

（5）面向连接的可靠传输（应用e.g.：文件传输）；

4\. TCP的流量控制

流量控制（flow control）
: 让发送方的发送速率不要太快，让接收方来得及接收。

利用**滑动窗口**机制可以方便的在TCP连接上实现对发送方的流量控制。

5\. TCP的拥塞控制

拥塞（congestion）
: 在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就变坏，这种情况叫做拥塞；

若出现拥塞不进行控制，整个网络的吞吐量将随输入负荷的增大而下降；

TCP的四种拥塞控制算法：慢开始（slow-start），拥塞避免（congestion avoidance），快重传（fast retransmit），快恢复（fast recovery）；

6\. TCP超时重传时间的选择

报文段的往返时间RTT；不能直接使用某次测量得到的RTT样本来计算超时重传时间RTO，而是通过RTT样本，计算加权平均往返时间RTTs。

7\. TCP可靠传输的实现

TCP基于以字节为单位的滑动窗口来实现可靠传输；

虽然发送方的发送窗口是根据接收方的接收窗口设置的，但在同一时刻，发送窗口和接收窗口不总是一样大，因为网络传送窗口值存在一定的时间滞后，另外发送方还可能根据网络拥塞状况适当减小窗口尺寸；

对于不按序到达的数据如何处理，TCP并无明确规定；

8\. TCP的运输连接管理 - 连接的建立

要解决的问题：（1）TCP双方能够确认对方的存在（2）双方能够写上一些参数（如窗口最大值等）（3）双方能对运输实体资源（如缓存大小，连接表中的项目等）进行分配；

两台想要进行TCP通信的主机，其中一台中的某个应用进程主动发起TCP连接建立，称为TCP客户；另一台被动等待的进程称为TCP服务器；将TCP建立连接的过程比喻为“握手”；“握手”需要在TCP客户和服务器之间交换三个报文段。

**“三报文握手”建立连接的过程**：最初两端的进程都处于关闭状态 -> TCP服务器进程创建传输控制块，用来存储TCP连接中的一些重要信息（如TCP连接表，指向发送和接收缓存的指针等）->
TCP服务器进程进入监听状态，等待TCP客户进程的连接请求 -> TCP客户进程创建传输控制块 -> “一握手”：客户进程向服务器进程发送连接请求报文段，进入同步发送状态 -> “二握手”：服务器进程收到该报文段后，如果同意，则向客户进程发送连接请求确认报文段，并进入同步已接收状态 -> “三握手”：客户进程向服务器进程发送一个普通的TCP确认报文段，进入连接已建立状态 -> 服务器收到该确认报文段后也进入连接已建立状态 -> 双方都已进入连接已建立

使用“三报文握手”而不是“二报文握手”是为了防止已失效的连接请求报文段突然又传送到了TCP服务器而导致错误。

9\. TCP运输连接管理 - 连接的释放

**通过“四报文挥手”释放连接过程**：“一挥手”：客户发送释放报文段，进入终止等待1状态 -> “二挥手”：服务器收到后，发送一个普通的确认报文段，进入关闭等待状态，通知高层应用进程，客户进程要断开与自己的连接；这时，客户进程到服务器进程这个方向的连接已释放，而服务器进程到客户进程方向的连接未关闭 -> 客户进程收到报文段后进入终止等待2状态 -> “三挥手”：服务器进程发送连接释放报文段，并进入最后确认状态 -> “四挥手”：客户进程收到该报文段后，发送普通的确认报文段，之后进入时间等待状态 -> 服务器进程收到该报文段后进入关闭状态 -> 客户进程等待2个MSL(Maximum Segment Lifetime, RFC793建议为2分钟)后进入关闭状态。

10\. TCP报文段的首部格式

与IP数据报的首部格式类似，都是由20字节的固定首部和最大40字节的扩展首部构成。

源端口：占16比特，写入源端口号，用来标识发送该TCP报文段的应用进程。

目的端口：占16比特，写入目的端口号，用来标识接收该报文段的应用进程。

应用层
==============

1\. 概述

应用层是计算机网络体系结构的最顶层，是设计和建立计算机网络的最终目的。

常见的应用：万维网www，域名系统DNS，动态主机配置DHCP，电子邮件，文件传送FTP和P2P文件共享，多媒体网络应用等。

2\. 客户-服务器方式（C/S方式）和对等方式（P2P方式）

开发一种新的网络应用，首先要考虑的问题是网络应用程序在各种端系统上的组织方式和他们之间的关系。目前流行的有两种：客户-服务器方式（C/S方式）和对等方式（P2P方式）。

**客户-服务器方式（C/S方式）**：

（1）服务和被服务的关系；客户是请求方，服务器是服务提供方；

（2）服务器总是在运行状态，并等待客户的服务请求，服务器具有固定端口号（例如http服务器的固定端口号为80,），而运行服务器的主机也具有固定的IP地址；

（3）传统、成熟的方式（应用包括www，电子邮件，文件传输FTP等）；

（4）应用服务通常是集中型的；

（5）由于一台服务器为多个客户机服务，常会出现服务器计算机跟不上众多客户机请求的情况，为此常用计算机集群（或服务器场）构建一个强大的虚拟服务器。

**对等方式（P2P方式）**：

（1）对等的，没有固定的服务请求者和服务提供者，每个对等方既是服务者又是请求者；

（2）目前流行的应用包括：P2P文件共享、即时通信、P2P流媒体、分布式存储等；

（3）服务分散型的；

（4）最突出的特征：可扩展性；
 
（5）成本优势

3\. 动态主机配置协议DHCP

通过DHCP服务器，各主机可以自动获取网络配置信息从而访问网络而不用手动配置。

DHCP在运输层使用UDP协议。DHCP服务器UDP端口为67，客户端口为68。

4\. 域名系统DNS

因特网早在1983年就开始采用层次结构的命名树做额外主机的名字（即域名），并使用分布式的域名系统DNS(Domain Name System)；DNS使大多数域名都在本地服务器解析，效率很高；

因特网采用的层次树状结构的域名结构：由若干分量组成，用“点”隔开，分别代表不同级别的域名（e.g.….三级域名.二级域名.顶级域名）。

顶级域名TLD(Top Level Domain)分为：国家顶级域名nTLD（例如：cn表示中国），通用顶级域名gTLD(例如com公司企业，net网络服务机构)，反向域arpa（用于反向域名解析，即IP地址反向解析为域名）。

在国家顶级域名下注册的二级域名均由该国家自行确定。我国将二级域名分为：类别域名（ac科研机构、com工、商、金融等企业、edu教育机构、gov政府部门、net提供网络服务的机构、mil军事机构和org非营利性组织），行政区域名（共34个，适用于各省自治区直辖市）。

域名服务器分为：根域名服务器（服务器集群），顶级域名服务器（管理该顶级域名下的所有二级域名），权限域名服务器（管理某个区的域名），本地域名服务器（起着代理的作用）。

域名解析的过程：递归查询，迭代查询。

5\. 文件传送协议FTP

文件传送协议FTP（File Transfer Protocol）是因特网上使用最广泛的文件传送协议。

FTP提供交互式的访问，允许客户知名文件的类型和格式（如是否使用ASCII码），并允许文件具有存取权限；FTP屏蔽了个计算机系统的细节，因而适用于在异构网络中任意计算机之间传送文件。

6\. 电子邮件

7\. 万维网WWW

